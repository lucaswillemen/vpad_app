<style type="text/css">
caption,th{text-align:left}table{background-color:transparent}caption{padding-top:8px;padding-bottom:8px;color:#777}.table{width:100%;max-width:100%;margin-bottom:20px}.table>tbody>tr>td,.table>tbody>tr>th,.table>tfoot>tr>td,.table>tfoot>tr>th,.table>thead>tr>td,.table>thead>tr>th{padding:8px;line-height:1.42857143;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>td,.table>caption+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>th,.table>thead:first-child>tr:first-child>td,.table>thead:first-child>tr:first-child>th{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>tbody>tr>td,.table-condensed>tbody>tr>th,.table-condensed>tfoot>tr>td,.table-condensed>tfoot>tr>th,.table-condensed>thead>tr>td,.table-condensed>thead>tr>th{padding:5px}.table-bordered,.table-bordered>tbody>tr>td,.table-bordered>tbody>tr>th,.table-bordered>tfoot>tr>td,.table-bordered>tfoot>tr>th,.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border:1px solid #ddd}.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border-bottom-width:2px}.table-striped>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}.table-hover>tbody>tr:hover,.table>tbody>tr.active>td,.table>tbody>tr.active>th,.table>tbody>tr>td.active,.table>tbody>tr>th.active,.table>tfoot>tr.active>td,.table>tfoot>tr.active>th,.table>tfoot>tr>td.active,.table>tfoot>tr>th.active,.table>thead>tr.active>td,.table>thead>tr.active>th,.table>thead>tr>td.active,.table>thead>tr>th.active{background-color:#f5f5f5}table col[class*=col-]{position:static;display:table-column;float:none}table td[class*=col-],table th[class*=col-]{position:static;display:table-cell;float:none}.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr.active:hover>th,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover{background-color:#e8e8e8}.table>tbody>tr.success>td,.table>tbody>tr.success>th,.table>tbody>tr>td.success,.table>tbody>tr>th.success,.table>tfoot>tr.success>td,.table>tfoot>tr.success>th,.table>tfoot>tr>td.success,.table>tfoot>tr>th.success,.table>thead>tr.success>td,.table>thead>tr.success>th,.table>thead>tr>td.success,.table>thead>tr>th.success{background-color:#dff0d8}.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr.success:hover>th,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover{background-color:#d0e9c6}.table>tbody>tr.info>td,.table>tbody>tr.info>th,.table>tbody>tr>td.info,.table>tbody>tr>th.info,.table>tfoot>tr.info>td,.table>tfoot>tr.info>th,.table>tfoot>tr>td.info,.table>tfoot>tr>th.info,.table>thead>tr.info>td,.table>thead>tr.info>th,.table>thead>tr>td.info,.table>thead>tr>th.info{background-color:#d9edf7}.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr.info:hover>th,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover{background-color:#c4e3f3}.table>tbody>tr.warning>td,.table>tbody>tr.warning>th,.table>tbody>tr>td.warning,.table>tbody>tr>th.warning,.table>tfoot>tr.warning>td,.table>tfoot>tr.warning>th,.table>tfoot>tr>td.warning,.table>tfoot>tr>th.warning,.table>thead>tr.warning>td,.table>thead>tr.warning>th,.table>thead>tr>td.warning,.table>thead>tr>th.warning{background-color:#fcf8e3}.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr.warning:hover>th,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover{background-color:#faf2cc}.table>tbody>tr.danger>td,.table>tbody>tr.danger>th,.table>tbody>tr>td.danger,.table>tbody>tr>th.danger,.table>tfoot>tr.danger>td,.table>tfoot>tr.danger>th,.table>tfoot>tr>td.danger,.table>tfoot>tr>th.danger,.table>thead>tr.danger>td,.table>thead>tr.danger>th,.table>thead>tr>td.danger,.table>thead>tr>th.danger{background-color:#f2dede}.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr.danger:hover>th,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover{background-color:#ebcccc}.table-responsive{min-height:.01%;overflow-x:auto}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tfoot>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>thead>tr>th{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>thead>tr>th:first-child{border-left:0}.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>thead>tr>th:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>th{border-bottom:0}}
md-input-container {
    display: inline-block;
    position: relative;
    padding: 2px;
    margin: 0px 0; 
    vertical-align: middle;
}
.layout-padding, .layout-padding-gt-sm, .layout-padding-gt-sm>*, .layout-padding-md, .layout-padding-md>*, .layout-padding>*, .layout-padding>.flex, .layout-padding>.flex-gt-sm, .layout-padding>.flex-md {
    padding: 4px;
}
</style>
<md-toolbar class="md-table-toolbar md-default">
    <div class="md-toolbar-tools">
        <span class="md-title">Pagamento de fatura </span> <span flex></span><span>{{data.valor | currency: "R$ "}} </span>
    </div>
</md-toolbar>
<div layout="column" layout-align="center center" layout-fill layout-padding ng-hide="start">
    <h3>Verificando faturas</h3>

    <md-progress-circular md-mode="indeterminate" md-diameter="40"></md-progress-circular>
</div>
<div class="nest" id="validationClose" ng-hide="step == 'confirm' || !start" layout="column" layout-gt-sm="row">
    <md-card flex-gt-sm="50">
        <md-subheader class="md-title md-no-sticky">Dados da fatura</md-subheader>
        <md-list>
            <md-divider></md-divider>
            <md-list-item>
                <p>Descrição: </p>
                {{data.desc}}
            </md-list-item>
            <md-divider></md-divider>
            <md-list-item>
                <p>Valor: </p>
                {{data.valor | currency: "R$ "}}
            </md-list-item>
            <md-divider></md-divider>
            <md-list-item>
                <p>Vencimento: </p>
                {{data.vencimento | date: "dd/MM/yyyy"}}
            </md-list-item>
            <md-divider></md-divider>
            <md-list-item class="md-3-line md-long-text">
                <div class="md-list-item-text">
                    <h3>Observações</h3>
                    <p>
                    Suas informações de cartão de crédito não serão salvas e deverão ser preenchidas em cada pagamento de fatura.
                    </p><br>
                    <p>
                    Você está em um ambiente seguro e seu pagamento será processado pelo gatway do Mercado Pago a qual será exibido no resumo da fatura do seu cartão de crédito.
                    </p>
                </div>
            </md-list-item>
        </md-list>
    </md-card>
    <md-card flex-gt-sm="50">
        <md-subheader class="md-title md-no-sticky">Informações do pagamento</md-subheader>
    <br>
        <form id="formPayment" name="form" method="post" class="form-horizontal" novalidate>
            <div layout-gt-sm="row" layout="column" layout-padding>
                <md-input-container class="md-block" flex-gt-sm>
                    <label>Cartão</label>
                    <input type="number" ng-model="data.card" class="form-control" ng-disabled="card_d" name="num" id="card" required data-checkout="cardNumber" ng-pattern="/^[0-9]{16}/" maxlength="16">
                    <div ng-messages="form.num.$error">
                        <div ng-message="required">Informe o número do seu cartão.</div>
                        <div ng-message="pattern">Cartão inválido</div>
                        <div ng-message="maxlength">Números demais</div>
                    </div>
                    <img ng-src="{{card_d[0].issuer.secure_thumbnail}}">
                </md-input-container>
                <md-button type="button" class="md-raised md-primary" ng-click="test_card()" ng-if="!card_d" ng-disabled="!form.num.$valid || load_card_prog">Verificar cartão</md-button>

                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>Código de segurança</label>
                    <input type="number" ng-model="data.cod" class="form-control" name="cod" maxlength="3" minlength="3" required data-checkout="securityCode">
                    <div ng-messages="form.cod.$error">
                        <div ng-message="required">Informe o código de segurança.</div>
                        <div ng-message="maxlength">Código de segurança possui 3 dígitos.</div>
                        <div ng-message="minlength">Código de segurança possui 3 dígitos.</div>
                    </div>
                </md-input-container>
            </div>
            <md-progress-linear md-mode="indeterminate" ng-show="load_card_prog" md-diameter="20"></md-progress-linear>
            <div layout-gt-sm="row" layout="column" layout-padding>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>Mês do vencimento</label>
                    <input type="number" ng-model="data.mes" class="form-control" name="mes" min="01" max="12" maxlength="2" required data-checkout="cardExpirationMonth">
                    <div ng-messages="form.mes.$error">
                        <div ng-message="required">Informe o mês do vencimento do cartão.</div>
                        <div ng-message="max">Mês inválido.</div>
                    </div>
                </md-input-container>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>Ano do vencimento</label>
                    <input type="number" ng-model="data.ano" class="form-control" name="ano" min="2017" max="2057" maxlength="4" required data-checkout="cardExpirationYear">
                    <div ng-messages="form.ano.$error">
                        <div ng-message="required">Informe o ano do vencimento do cartão.</div>
                        <div ng-message="min">O ano deve ser maior que 2017.</div>
                        <div ng-message="max">Ano inválido.</div>
                    </div>
                </md-input-container>
            </div>
            <div layout-gt-sm="row" layout="column" layout-padding>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>Nome do titular</label>
                    <input type="text" ng-model="data.titular" class="form-control" name="titular" required data-checkout="cardholderName">
                    <div ng-messages="form.titular.$error">
                        <div ng-message="required">Informe o nome do titular do cartão.</div>
                    </div>
                </md-input-container>
            </div>
            <div layout-gt-sm="row" layout="column" layout-padding>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>Email do titular</label>
                    <input type="text" ng-model="data.email" class="form-control" name="email" required>
                    <div ng-messages="form.email.$error">
                        <div ng-message="required">Informe o email do titular do cartão.</div>
                    </div>
                </md-input-container>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d">
                    <label>CPF do titular</label>
                    <input data-checkout="docType" type="hidden" value="CPF" />
                    <input type="text" ng-model="data.cpf" class="form-control" name="cpf" required data-checkout="docNumber" ui-br-cpfcnpj-mask>
                    <div ng-messages="form.cpf.$error">
                        <div ng-message="required">Informe o cpf do titular do cartão.</div>
                    </div>
                </md-input-container>
            </div>
            <div layout-gt-sm="row" layout="column" layout-padding>
                <md-input-container class="md-block" flex-gt-sm ng-if="card_d" name="parcela">
                    <label for="email">Escolha a forma de pagamento</label>
                    <md-select type="text" class="form-control" required ng-model="data.parc">
                        <md-option ng-repeat="p in card_d[0].payer_costs" value="{{p.installments}}">{{p.recommended_message}}</md-option>
                    </md-select>
                    <div ng-messages="form.parcela.$error">
                        <div ng-message="required">Informe a quantidade de parcelas.</div>
                    </div>
                </md-input-container>
            </div>
            <div layout="row" layout-align="end center" layout-padding>
                <md-progress-circular md-mode="indeterminate" ng-show="load_card_prog2" md-diameter="30" ></md-progress-circular>
                <md-button ng-if="card_d" type="submit" class="md-raised md-primary" ng-disabled="form.$invalid || !card_d || load_card_prog2" ng-click="pay()" >Completar venda</md-button>
            </div>
        </form>
    </md-card>
</div>
<div class="content-wrap" ng-show="step == 'confirm'">
    <div layout="row" flex style="width: 100%" layout-padding layout-align="center center">
        <img src="../src/img/logo_icon/ms-icon-150x150.png" style="width: 6%">
        <h2>vPad, Inc.</h2><span flex></span>
        <small class="pull-right">Data: {{today | date:'dd/MM/yyyy'}}</small>
    </div>
    <hr>
    <div layout="column" layout-gt-sm>
        <div layout="column" layout-padding flex="50">
            <h3>Emissor</h3>
            <address>
            <br>Telefone: (22) 999-666-591
            <br/>Email: contato@vpad.com.br
            <br/>CNPJ: 19.398.659/0001-76
        </address>
        </div>
        <div layout="column" layout-padding flex="50">
            <h3>Cliente</h3>
            <address>
            <strong>{{data.titular}}</strong>
            <span ng-if="user_dados.cidade"><br/> Cdade: {{user_dados.cidade}}</span>
            <span ng-if="user_dados.email"><br/> CPF: {{data.cpf}}</span>
            <span ng-if="user_dados.email"><br/> Email: {{user_dados.email}}</span>
        </address>
        </div>
    </div>
    <div layout="column" layout-gt-sm layout-padding>
        <fieldset flex>
            <legend>Detalhes</legend>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Qntd</th>
                        <th>Descrição</th>
                        <th>Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>{{send_pay.desc}}</td>
                        <td>{{send_pay.val | currency: 'R$ '}}</td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
        <fieldset flex>
            <legend>Informações de pagamento</legend>
            <img ng-src="{{card_d[0].issuer.secure_thumbnail}}">
            <p class="text-muted well well-sm no-shadow" style="margin-top: 10px;">
                Cartão final: {{response_mp.last_four_digits}}
            </p>
            <div class="table-responsive">
                <table class="table">
                    <tr>
                        <th style="width:50%">Subtotal:</th>
                        <td>{{send_pay.val | currency: 'R$ '}}</td>
                    </tr>
                    <tr>
                        <th>Total:</th>
                        <td>{{send_pay.val | currency: 'R$ '}}</td>
                    </tr>
                </table>
            </div>
        </fieldset>
    </div>
    <div layout="column">
        <md-progress-linear md-mode="indeterminate" ng-show="load_show" md-diameter="20"></md-progress-linear>
        <md-button ng-click="submit_pay(); load_show = true;" class="md-raised md-primary" flex> Confirmar compra</md-button>
    </div>
</div>